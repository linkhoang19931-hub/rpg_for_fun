<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RPG cá»• Ä‘iá»ƒn â€” Tiáº¿ng Viá»‡t (HTML Ä‘Æ¡n)</title>
  <style>
    :root{--bg:#0f0f13;--panel:#1a1b22;--muted:#2a2b36;--text:#e6e6ea;--accent:#6d7dff;--green:#38c172;--red:#e3342f;--amber:#ffb300}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .container{max-width:1100px;margin:0 auto;padding:16px;display:flex;flex-direction:column;gap:12px}
    .row{display:grid;gap:12px}
    @media(min-width:1024px){.row{grid-template-columns:1.1fr 0.9fr 1fr}}
    .card{background:var(--panel);border-radius:16px;padding:14px;box-shadow:0 0 0 1px #00000033}
    .btn{background:var(--muted);border:none;color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
    .btn:hover{filter:brightness(1.1)}
    .btn.primary{background:var(--accent)}
    .btn.green{background:var(--green)}
    .btn.red{background:var(--red)}
    .btn.amber{background:var(--amber);color:#111}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .stat{display:inline-block;background:#00000033;padding:4px 8px;border-radius:8px;margin-right:6px}
    .grid{display:grid;gap:4px}
    .tile{aspect-ratio:1/1;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:13px;user-select:none;cursor:pointer;position:relative}
    .tile .me{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:18px}
    .ring{outline:3px solid var(--accent)}
    .legend{display:flex;gap:8px;flex-wrap:wrap;font-size:12px}
    .legend span{display:inline-flex;align-items:center;gap:4px}
    .log{height:330px;overflow:auto;display:flex;flex-direction:column-reverse;gap:6px}
    .log .item{background:#00000033;padding:6px 8px;border-radius:8px}
    .badge{font-size:11px;padding:2px 6px;border-radius:999px;background:#00000055}
    .right{display:flex;flex-direction:column;gap:12px}
    .sectionTitle{font-weight:600;margin-bottom:6px}
    .mapHeader{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
    .select{background:#0b0b10;border:1px solid #2d2e3b;color:var(--text);border-radius:8px;padding:6px 8px}
    .hr{height:1px;background:#00000055;margin:8px 0}
    .kbd{background:#111;border:1px solid #333;border-bottom-width:3px;border-radius:6px;padding:1px 6px;font-size:12px}
    /* tile colors */
    .plain{background:#90d89022}
    .forest{background:#2ecc7130}
    .dungeon{background:#94a3b833}
    .town{background:#ffecb322}
    .hint{opacity:.75}
    /* modal */
    dialog{border:none;border-radius:14px;background:#1d1e26;color:var(--text);padding:0;max-width:520px}
    dialog::backdrop{background:#0008}
    .modal{padding:14px}
    .modal .title{font-weight:700;margin-bottom:8px}
    .modal .actions{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
  </style>
</head>
<body>
  <div class="container">
    <header class="card" style="display:flex;align-items:center;justify-content:space-between;gap:8px">
      <div>
        <div style="font-size:20px;font-weight:800">âš”ï¸ RPG cá»• Ä‘iá»ƒn (D&D mini) â€” HTML</div>
        <div style="opacity:.8;font-size:12px">Giao diá»‡n tiáº¿ng Viá»‡t â€¢ LÆ°u/Táº£i báº±ng localStorage â€¢ Di chuyá»ƒn báº±ng <span class="kbd">Click chuá»™t</span> vÃ o Ã´ ká» bÃªn</div>
      </div>
      <div class="toolbar">
        <button class="btn primary" id="newGameBtn">Báº¯t Ä‘áº§u má»›i</button>
        <button class="btn" id="saveBtn">LÆ°u</button>
        <button class="btn" id="loadBtn">Táº£i</button>
      </div>
    </header>

    <section class="row">
      <div class="card">
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
          <div style="font-weight:700">ğŸ§™â€â™‚ï¸ <span id="pName">Máº¡o hiá»ƒm giáº£</span></div>
          <div class="stat">Cáº¥p: <b id="pLevel">1</b></div>
          <div class="stat">XP: <b id="pXP">0/10</b></div>
          <div class="stat">HP: <b id="pHP">20/20</b></div>
          <div class="stat">ATK: <b id="pATK">4</b></div>
          <div class="stat">DEF: <b id="pDEF">1</b></div>
          <div class="stat">VÃ ng: <b id="pGold">5</b></div>
          <div class="stat">BÃ¬nh: <b id="pPot">2</b></div>
          <div class="stat">Vá»‹ trÃ­: <b id="pPos">(1,1)</b></div>
        </div>
      </div>
      <div class="card">
        <div class="sectionTitle">ğŸ“œ Gá»£i Ã½ nhanh</div>
        <ul style="margin:6px 0 0 18px">
          <li>Click chuá»™t vÃ o <b>Ã´ ká» bÃªn</b> Ä‘á»ƒ di chuyá»ƒn.</li>
          <li>Vá» <b>ğŸ˜ï¸ LÃ ng</b> Ä‘á»ƒ há»“i phá»¥c, mua bÃ¬nh.</li>
          <li>Gáº·p quÃ¡i: Táº¥n cÃ´ng/PhÃ²ng thá»§/Cháº¡y trá»‘n.</li>
        </ul>
        <div class="hr"></div>
        <div class="legend"><span>ğŸ˜ï¸ <b>LÃ ng</b></span><span>ğŸŒ¾ Äá»“ng</span><span>ğŸŒ² Rá»«ng</span><span>ğŸ•³ï¸ Háº§m</span></div>
      </div>
      <div class="card right">
        <div>
          <div class="sectionTitle">ğŸ¯ HÃ nh Ä‘á»™ng ngoÃ i giao tranh</div>
          <div class="toolbar">
            <button class="btn green" id="healTownBtn">Trá»‹ thÆ°Æ¡ng á»Ÿ LÃ ng</button>
            <button class="btn amber" id="buyPotionBtn">Mua bÃ¬nh (5 vÃ ng)</button>
            <button class="btn" id="rollD20Btn">Äá»• xÃºc xáº¯c (d20)</button>
          </div>
        </div>
        <div>
          <div class="sectionTitle">ğŸ“ Nháº­t kÃ½</div>
          <div id="log" class="log"></div>
        </div>
      </div>
    </section>

    <section class="row" style="grid-template-columns:1fr 1fr;align-items:start">
      <div class="card">
        <div class="mapHeader">
          <div class="sectionTitle">ğŸ—ºï¸ Báº£n Ä‘á»“ <span id="mapSizeBadge" class="badge">8Ã—8</span></div>
          <div class="toolbar">
            <label for="sizeSel" style="font-size:12px;opacity:.8">KÃ­ch thÆ°á»›c</label>
            <select id="sizeSel" class="select">
              <option>6</option><option selected>8</option><option>10</option><option>12</option>
            </select>
          </div>
        </div>
        <div id="grid" class="grid"></div>
      </div>

      <div class="card">
        <div class="sectionTitle">âš”ï¸ Giao tranh</div>
        <div id="combatPanel" style="display:none">
          <div id="enemyLine" style="margin-bottom:6px"></div>
          <div class="toolbar">
            <button class="btn red" id="atkBtn">Táº¥n cÃ´ng (d20)</button>
            <button class="btn amber" id="defBtn">PhÃ²ng thá»§</button>
            <button class="btn" id="fleeBtn">Cháº¡y trá»‘n</button>
          </div>
        </div>
        <div id="noCombat" class="hint">KhÃ´ng cÃ³ káº» Ä‘á»‹ch xung quanh.</div>
      </div>
    </section>
  </div>

  <!-- Modal ThÃ´ng bÃ¡o Ä‘Æ¡n giáº£n-->
  <dialog id="modal">
    <div class="modal">
      <div class="title" id="modalTitle">ThÃ´ng bÃ¡o</div>
      <div id="modalBody">...</div>
      <div class="actions">
        <button class="btn" onclick="document.getElementById('modal').close()">ÄÃ³ng</button>
      </div>
    </div>
  </dialog>

  <script>
  (function(){
    const STORAGE_KEY = 'rpg_vn_html_save_v1';

    const TILES = {
      TOWN: { id:'TOWN', label:'ğŸ˜ï¸ LÃ ng', cls:'town' },
      PLAIN:{ id:'PLAIN',label:'ğŸŒ¾ Äá»“ng', cls:'plain' },
      FOREST:{ id:'FOREST',label:'ğŸŒ² Rá»«ng', cls:'forest' },
      DUNGEON:{ id:'DUNGEON',label:'ğŸ•³ï¸ Háº§m', cls:'dungeon' }
    };

    const ENEMIES = [
      { name:'Chuá»™t hang', emoji:'ğŸ€', hp:[4,7], atk:[1,3], gold:[1,3], xp:[2,4] },
      { name:'YÃªu tinh', emoji:'ğŸ§â€â™‚ï¸', hp:[6,10], atk:[2,4], gold:[2,5], xp:[3,6] },
      { name:'Bá»™ xÆ°Æ¡ng', emoji:'ğŸ¦´', hp:[8,12], atk:[3,5], gold:[3,6], xp:[4,8] },
      { name:'Slime', emoji:'ğŸ«§', hp:[5,9], atk:[1,4], gold:[1,4], xp:[2,5] },
    ];

    const roll = (s=6)=>Math.floor(Math.random()*s)+1;
    const rollRange = ([a,b])=> a + Math.floor(Math.random()*(b-a+1));
    const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));

    let state = null;

    function newPlayer(){
      return {name:'Máº¡o hiá»ƒm giáº£', level:1, xp:0, hp:20, maxHp:20, atk:4, def:1, gold:5, potions:2, pos:{x:0,y:0}};
    }

    function makeMap(size){
      const m = Array.from({length:size},()=>Array(size).fill(TILES.PLAIN.id));
      m[0][0]=TILES.TOWN.id;
      for(let y=0;y<size;y++){
        for(let x=0;x<size;x++){
          if(x===0&&y===0) continue;
          const r=Math.random();
          if(r<0.15) m[y][x]=TILES.FOREST.id; else if(r>0.92) m[y][x]=TILES.DUNGEON.id; else m[y][x]=TILES.PLAIN.id;
        }
      }
      return m;
    }

    function newEnemy(){
      const b = ENEMIES[Math.floor(Math.random()*ENEMIES.length)];
      const e = { name:b.name, emoji:b.emoji, hp:rollRange(b.hp), atk:rollRange(b.atk), gold:rollRange(b.gold), xp:rollRange(b.xp) };
      e.maxHp=e.hp; return e;
    }

    function addLog(msg){
      state.log.unshift(msg);
      state.log = state.log.slice(0,80);
      renderLog();
    }

    function save(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); addLog('ğŸ’¾ ÄÃ£ lÆ°u tiáº¿n Ä‘á»™.'); } catch(e){ addLog('âš ï¸ LÆ°u tháº¥t báº¡i.'); } }
    function load(){ try{ const raw=localStorage.getItem(STORAGE_KEY); if(!raw) return addLog('â„¹ï¸ ChÆ°a cÃ³ báº£n lÆ°u.'); state = JSON.parse(raw); state.enemy=null; addLog('ğŸ“‚ ÄÃ£ táº£i báº£n lÆ°u.'); renderAll(); } catch(e){ addLog('âš ï¸ Táº£i tháº¥t báº¡i.'); } }

    function newGame(){
      state = { size:8, map:makeMap(8), player:newPlayer(), enemy:null, log:['ğŸ® Báº¯t Ä‘áº§u hÃ nh trÃ¬nh táº¡i LÃ ng.'] };
      renderAll();
      addLog('âœ¨ Tháº¿ giá»›i má»›i Ä‘Æ°á»£c táº¡o.');
    }

    function levelCheck(p){
      let leveled=false; 
      while(p.xp >= p.level*10){ p.xp -= p.level*10; p.level++; p.maxHp+=4; p.atk++; if(p.level%2===0) p.def++; p.hp=p.maxHp; leveled=true; }
      if(leveled) addLog(`â¬†ï¸ LÃªn cáº¥p ${p.level}! Chá»‰ sá»‘ tÄƒng vÃ  há»“i Ä‘áº§y HP.`);
    }

    function tileAt(x,y){ return state.map[y]?.[x] ?? TILES.PLAIN.id; }
    function tileMeta(id){ return Object.values(TILES).find(t=>t.id===id)||TILES.PLAIN; }

    function tryEncounter(tileId){
      const base = tileId===TILES.FOREST.id?0.4 : tileId===TILES.DUNGEON.id?0.7 : 0.15;
      if(Math.random()<base){ state.enemy=newEnemy(); addLog(`âš ï¸ Gáº·p ${state.enemy.emoji} ${state.enemy.name}! HP ${state.enemy.hp}.`); renderCombat(); }
    }

    function moveTo(nx,ny){
      if(state.enemy) return; // khÃ´ng di chuyá»ƒn khi Ä‘ang giao tranh
      const p = state.player; const size=state.size;
      nx = clamp(nx,0,size-1); ny=clamp(ny,0,size-1);
      // chá»‰ cho phÃ©p click Ã´ ká» bÃªn (Manhattan 1)
      const dist = Math.abs(nx-p.pos.x)+Math.abs(ny-p.pos.y);
      if(dist!==1){ addLog('ğŸ‘£ HÃ£y click Ã´ ká» bÃªn Ä‘á»ƒ di chuyá»ƒn.'); return; }
      p.pos.x=nx; p.pos.y=ny;
      const tId = tileAt(nx,ny); const meta = tileMeta(tId);
      addLog(`ğŸš¶â€â™‚ï¸ Di chuyá»ƒn Ä‘áº¿n Ã´: ${meta.label}.`);
      // nghá»‰ á»Ÿ lÃ ng
      if(tId===TILES.TOWN.id){
        const healed = Math.min(p.maxHp, p.hp+3)-p.hp; if(healed>0) addLog(`ğŸ’’ Nghá»‰ á»Ÿ LÃ ng, há»“i ${healed} HP.`); p.hp=Math.min(p.maxHp,p.hp+3);
      }
      renderHUD(); renderMap();
      // thá»­ gáº·p quÃ¡i
      setTimeout(()=>tryEncounter(tId), 50);
    }

    // Combat
    function attack(){ if(!state.enemy) return; const d20=roll(20); const hit=d20>=8; if(hit){ const dmg=Math.max(1, roll(6)+state.player.atk-1); state.enemy.hp -= dmg; addLog(`ğŸ—¡ï¸ Báº¡n Ä‘Ã¡nh trÃºng (d20=${d20}), gÃ¢y ${dmg} sÃ¡t thÆ°Æ¡ng!`); if(state.enemy.hp<=0){ victory(); return; } } else addLog(`ğŸ›¡ï¸ Báº¡n Ä‘Ã¡nh trÆ°á»£t (d20=${d20}).`); setTimeout(enemyTurn, 350); renderCombat(); }
    function defend(){ if(!state.enemy) return; const block = roll(6)+state.player.def; addLog(`ğŸ›¡ï¸ PhÃ²ng thá»§, tÄƒng cháº·n táº¡m thá»i: ${block}.`); const d20=roll(20); const hit=d20>=9; if(hit){ const dmg=Math.max(0, state.enemy.atk + roll(4) - 2 - block); state.player.hp=Math.max(0, state.player.hp-dmg); addLog(`â˜‚ï¸ ÄÃ£ cháº·n bá»›t, nháº­n ${dmg} sÃ¡t thÆ°Æ¡ng.`); if(state.player.hp<=0){ gameOver(); } } else addLog(`ğŸ™‚ ${state.enemy.emoji} ${state.enemy.name} Ä‘Ã¡nh trÆ°á»£t (d20=${d20}).`); renderHUD(); }
    function flee(){ if(!state.enemy) return; const ok=roll(20)>=11; if(ok){ addLog('ğŸƒâ€â™‚ï¸ Báº¡n cháº¡y thoÃ¡t!'); state.enemy=null; } else { addLog('ğŸš« Cháº¡y khÃ´ng thÃ nh, Ä‘á»‹ch pháº£n cÃ´ng!'); enemyTurn(); } renderCombat(); }
    function enemyTurn(){ if(!state.enemy) return; const d20=roll(20); const hit=d20>=9; if(hit){ const dmg=Math.max(1, state.enemy.atk - state.player.def + roll(4) - 1); state.player.hp=Math.max(0, state.player.hp - dmg); addLog(`â˜ ï¸ ${state.enemy.emoji} ${state.enemy.name} Ä‘Ã¡nh trÃºng (d20=${d20}), báº¡n máº¥t ${dmg} HP!`); if(state.player.hp<=0){ gameOver(); } } else addLog(`ğŸ™‚ ${state.enemy.emoji} ${state.enemy.name} Ä‘Ã¡nh trÆ°á»£t (d20=${d20}).`); renderHUD(); }
    function victory(){ addLog(`ğŸ† Háº¡ gá»¥c ${state.enemy.emoji} ${state.enemy.name}! +${state.enemy.gold} vÃ ng, +${state.enemy.xp} XP.`); state.player.gold+=state.enemy.gold; state.player.xp+=state.enemy.xp; state.enemy=null; levelCheck(state.player); renderHUD(); renderCombat(); }
    function gameOver(){ addLog('ğŸ’€ Báº¡n Ä‘Ã£ gá»¥c ngÃ£. Nháº¥n "Báº¯t Ä‘áº§u má»›i".'); renderHUD(); }

    function healAtTown(){ const tile=tileAt(state.player.pos.x,state.player.pos.y); if(tile!==TILES.TOWN.id) return addLog('ğŸ˜ï¸ HÃ£y vá» LÃ ng Ä‘á»ƒ trá»‹ thÆ°Æ¡ng.'); const cost=3; if(state.player.gold<cost) return addLog('ğŸ’¸ KhÃ´ng Ä‘á»§ vÃ ng (cáº§n 3).'); const healed=Math.min(state.player.maxHp,state.player.hp+12)-state.player.hp; state.player.gold-=cost; state.player.hp += healed; addLog(`ğŸ’– Trá»‹ thÆ°Æ¡ng á»Ÿ LÃ ng (3 vÃ ng), +${healed} HP.`); renderHUD(); }
    function buyPotion(){ const tile=tileAt(state.player.pos.x,state.player.pos.y); if(tile!==TILES.TOWN.id) return addLog('ğŸ˜ï¸ Chá»‰ bÃ¡n bÃ¬nh á»Ÿ LÃ ng.'); const cost=5; if(state.player.gold<cost) return addLog('ğŸ’° KhÃ´ng Ä‘á»§ vÃ ng (cáº§n 5).'); state.player.gold-=cost; state.player.potions++; addLog('ğŸ§ª Mua 1 bÃ¬nh há»“i (5 vÃ ng).'); renderHUD(); }

    // UI renderers
    function renderHUD(){
      const p=state.player; 
      document.getElementById('pLevel').textContent=p.level;
      document.getElementById('pXP').textContent=`${p.xp}/${p.level*10}`;
      document.getElementById('pHP').textContent=`${p.hp}/${p.maxHp}`;
      document.getElementById('pATK').textContent=p.atk;
      document.getElementById('pDEF').textContent=p.def;
      document.getElementById('pGold').textContent=p.gold;
      document.getElementById('pPot').textContent=p.potions;
      document.getElementById('pPos').textContent=`(${p.pos.x+1},${p.pos.y+1})`;
    }

    function renderLog(){
      const el=document.getElementById('log');
      el.innerHTML = state.log.map(l=>`<div class="item">${l}</div>`).join('');
    }

    function renderMap(){
      const grid = document.getElementById('grid');
      const s = state.size; grid.style.gridTemplateColumns = `repeat(${s}, minmax(0,1fr))`;
      document.getElementById('mapSizeBadge').textContent = `${s}Ã—${s}`;
      grid.innerHTML='';
      for(let y=0;y<s;y++){
        for(let x=0;x<s;x++){
          const id=state.map[y][x]; const meta=tileMeta(id);
          const tile=document.createElement('div'); tile.className=`tile ${meta.cls}`; tile.title=meta.label;
          tile.innerHTML = `<span class="hint">${meta.label.split(' ')[0]}</span>`;
          // click move (adjacent only)
          tile.addEventListener('click', ()=> moveTo(x,y));
          if(x===state.player.pos.x && y===state.player.pos.y){ tile.classList.add('ring'); tile.innerHTML=`<div class="me">ğŸ§</div>`; }
          grid.appendChild(tile);
        }
      }
    }

    function renderCombat(){
      const c=document.getElementById('combatPanel');
      const n=document.getElementById('noCombat');
      if(state.enemy){ c.style.display='block'; n.style.display='none'; document.getElementById('enemyLine').textContent = `Äang giao chiáº¿n vá»›i: ${state.enemy.emoji} ${state.enemy.name} â€¢ HP: ${state.enemy.hp}/${state.enemy.maxHp}`; }
      else { c.style.display='none'; n.style.display='block'; }
    }

    function renderAll(){ renderHUD(); renderMap(); renderLog(); renderCombat(); bindMapSize(); }

    function bindMapSize(){
      const sel=document.getElementById('sizeSel'); sel.value = String(state.size);
      sel.onchange = ()=>{ const s=parseInt(sel.value,10)||8; state.size=s; state.map=makeMap(s); state.player.pos={x:0,y:0}; state.enemy=null; addLog('ğŸ§­ Táº¡o láº¡i báº£n Ä‘á»“ vá»›i kÃ­ch thÆ°á»›c má»›i.'); renderAll(); };
    }

    // Buttons
    document.getElementById('newGameBtn').onclick=newGame;
    document.getElementById('saveBtn').onclick=save;
    document.getElementById('loadBtn').onclick=load;
    document.getElementById('healTownBtn').onclick=healAtTown;
    document.getElementById('buyPotionBtn').onclick=buyPotion;
    document.getElementById('rollD20Btn').onclick=()=>addLog(`ğŸ² Báº¡n Ä‘á»• d20 Ä‘Æ°á»£c: ${roll(20)}.`);

    document.getElementById('atkBtn').onclick=attack;
    document.getElementById('defBtn').onclick=defend;
    document.getElementById('fleeBtn').onclick=flee;

    // boot
    newGame();
  })();
  </script>
</body>
</html>
